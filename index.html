<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CS Department - Student Portal</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Link to your CSS files -->
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="css/components.css">
    <link rel="stylesheet" href="css/responsive.css">
    
    <style>
        /* Base styles and variables */
        :root {
            --primary: #0B4619;
            --secondary: #116530;
            --accent: #21B573;
            --background: #A0E4CB;
            --base: #F8F9FA;
            --text-dark: #1a1a1a;
            --text-light: #4a4a4a;
            --white: #ffffff;
            --gray-light: #e9ecef;
            --gray: #6c757d;
            --danger: #dc3545;
            --warning: #ffc107;
            --success: #28a745;
            
            --shadow-sm: 0 1px 3px rgba(0,0,0,0.12);
            --shadow-md: 0 4px 6px rgba(0,0,0,0.1);
            --shadow-lg: 0 10px 25px rgba(0,0,0,0.1);
            
            --border-radius: 8px;
            --border-radius-lg: 12px;
            
            --font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: var(--font-family);
            background-color: var(--base);
            color: var(--text-dark);
            line-height: 1.6;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 1rem;
        }

        /* Additional styles for new content */
        .course-card {
            border-left: 4px solid var(--accent);
        }
        
        .course-code {
            font-weight: 600;
            color: var(--primary);
        }
        
        .course-credits {
            background: var(--background);
            padding: 0.25rem 0.5rem;
            border-radius: 12px;
            font-size: 0.8rem;
        }
        
        .department-news {
            border-left: 4px solid var(--secondary);
        }
    </style>
</head>
<body>
    <!-- Navigation Header -->
    <header class="header" id="header">
        <nav class="nav container">
            <div class="nav__brand">
                <div class="nav__logo">üéì</div>
                <div>
                    <span class="nav__title">Computer Science Department</span>
                    <small class="nav__subtitle" style="display: block; font-size: 0.8rem; color: var(--text-light);">
                        Student Information Portal - 2026 Academic Year
                    </small>
                </div>
            </div>
            
            <div class="nav__menu" id="nav-menu">
                <ul class="nav__list" id="nav-list">
                    <!-- Navigation items will be populated by JavaScript -->
                </ul>
                
                <div class="nav__user" id="nav-user">
                    <!-- User menu will be populated by JavaScript -->
                </div>
            </div>
            
            <div class="nav__toggle" id="nav-toggle">
                <span class="hamburger"></span>
                <span class="hamburger"></span>
                <span class="hamburger"></span>
            </div>
        </nav>
    </header>

    <!-- Main Content Area -->
    <main class="main" id="main-content">
        <!-- Pages will be dynamically loaded here -->
        <div id="loading-spinner" class="loading-spinner d-none">
            <div class="spinner"></div>
        </div>
    </main>

    <!-- Toast Notifications -->
    <div id="toast-container" class="toast-container"></div>

    <script>
        // Combined JavaScript - Helpers Class
        class Helpers {
            static formatDate(dateString) {
                const date = new Date(dateString);
                return date.toLocaleDateString('en-US', {
                    year: 'numeric',
                    month: 'short',
                    day: 'numeric',
                    hour: '2-digit',
                    minute: '2-digit'
                });
            }

            static debounce(func, wait) {
                let timeout;
                return function executedFunction(...args) {
                    const later = () => {
                        clearTimeout(timeout);
                        func(...args);
                    };
                    clearTimeout(timeout);
                    timeout = setTimeout(later, wait);
                };
            }

            static getInitials(name) {
                return name
                    .split(' ')
                    .map(part => part.charAt(0))
                    .join('')
                    .toUpperCase()
                    .slice(0, 2);
            }

            static showToast(message, type = 'success', duration = 5000) {
                const container = document.getElementById('toast-container');
                const toast = document.createElement('div');
                toast.className = `toast ${type}`;
                
                const icon = type === 'success' ? '‚úì' : type === 'error' ? '‚úó' : '‚ö†';
                toast.innerHTML = `
                    <span class="toast__icon">${icon}</span>
                    <span class="toast__message">${message}</span>
                `;
                
                container.appendChild(toast);
                
                setTimeout(() => {
                    toast.remove();
                }, duration);
            }

            static showLoading() {
                const spinner = document.getElementById('loading-spinner');
                if (spinner) spinner.classList.remove('d-none');
            }

            static hideLoading() {
                const spinner = document.getElementById('loading-spinner');
                if (spinner) spinner.classList.add('d-none');
            }

            static validateEmail(email) {
                const re = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
                return re.test(email);
            }

            static validatePhone(phone) {
                const re = /^\+?[\d\s-()]{10,}$/;
                return re.test(phone);
            }

            static sanitizeInput(input) {
                const div = document.createElement('div');
                div.textContent = input;
                return div.innerHTML;
            }

            static getLevelLabel(level) {
                const levels = {
                    100: '100 Level',
                    200: '200 Level',
                    300: '300 Level',
                    400: '400 Level',
                    500: '500 Level'
                };
                return levels[level] || `${level} Level`;
            }

            static getCategoryLabel(category) {
                const categories = {
                    general: 'General',
                    exam: 'Exam',
                    registration: 'Registration',
                    security: 'Security',
                    event: 'Event'
                };
                return categories[category] || category;
            }
        }

        // Validators Class
        class Validators {
            static validateSignupForm(formData) {
                const errors = {};

                // Name validation
                if (!formData.name.trim()) {
                    errors.name = 'Name is required';
                } else if (formData.name.trim().length < 2) {
                    errors.name = 'Name must be at least 2 characters';
                }

                // Email validation
                if (!formData.email.trim()) {
                    errors.email = 'Email is required';
                } else if (!Helpers.validateEmail(formData.email)) {
                    errors.email = 'Please enter a valid email address';
                }

                // Matric number validation
                if (!formData.matricNumber.trim()) {
                    errors.matricNumber = 'Matric number is required';
                }

                // Level validation
                if (!formData.level) {
                    errors.level = 'Level is required';
                } else if (![100, 200, 300, 400, 500].includes(parseInt(formData.level))) {
                    errors.level = 'Please select a valid level';
                }

                // Student type validation
                if (!formData.studentType) {
                    errors.studentType = 'Student type is required';
                }

                // Phone validation
                if (!formData.phone.trim()) {
                    errors.phone = 'Phone number is required';
                } else if (!Helpers.validatePhone(formData.phone)) {
                    errors.phone = 'Please enter a valid phone number';
                }

                // Password validation
                if (!formData.password) {
                    errors.password = 'Password is required';
                } else if (formData.password.length < 6) {
                    errors.password = 'Password must be at least 6 characters';
                }

                return {
                    isValid: Object.keys(errors).length === 0,
                    errors
                };
            }

            static validateLoginForm(formData) {
                const errors = {};

                if (!formData.identifier || !formData.identifier.trim()) {
                    errors.identifier = 'Email or matric number is required';
                }

                if (!formData.password) {
                    errors.password = 'Password is required';
                }

                return {
                    isValid: Object.keys(errors).length === 0,
                    errors
                };
            }

            static validateProfileForm(formData) {
                const errors = {};

                if (!formData.name.trim()) {
                    errors.name = 'Name is required';
                }

                if (!formData.email.trim()) {
                    errors.email = 'Email is required';
                } else if (!Helpers.validateEmail(formData.email)) {
                    errors.email = 'Please enter a valid email address';
                }

                if (!formData.phone.trim()) {
                    errors.phone = 'Phone number is required';
                } else if (!Helpers.validatePhone(formData.phone)) {
                    errors.phone = 'Please enter a valid phone number';
                }

                return {
                    isValid: Object.keys(errors).length === 0,
                    errors
                };
            }
        }

        // API Class - FIXED VERSION
        class API {
            constructor() {
                this.baseURL = 'https://department-board-backend.onrender.com/api';
                this.token = localStorage.getItem('authToken');
            }

            async request(endpoint, options = {}) {
                const url = `${this.baseURL}${endpoint}`;
                
                const config = {
                    headers: {
                        'Content-Type': 'application/json',
                        ...options.headers
                    },
                    ...options
                };

                // Add authorization header if token exists
                if (this.token) {
                    config.headers.Authorization = `Bearer ${this.token}`;
                }

                try {
                    console.log(`Making API request to: ${url}`);
                    const response = await fetch(url, config);

                    let data;
                    const contentType = response.headers.get('content-type');
                    if (contentType && contentType.includes('application/json')) {
                        data = await response.json();
                    } else {
                        data = await response.text();
                    }

                    if (!response.ok) {
                        console.error('API Error Response:', data);
                        throw new Error(data.error || data.message || `HTTP ${response.status}`);
                    }

                    console.log('API Success Response:', data);
                    return data;
                } catch (error) {
                    console.error('API Request failed:', error);
                    
                    if (error.name === 'TypeError') {
                        throw new Error('Network error - check if server is running');
                    }
                    
                    throw error;
                }
            }

            setToken(token) {
                this.token = token;
                localStorage.setItem('authToken', token);
            }

            removeToken() {
                this.token = null;
                localStorage.removeItem('authToken');
            }

            // Authentication endpoints
            async signup(userData) {
                return this.request('/auth/signup', {
                    method: 'POST',
                    body: JSON.stringify(userData)
                });
            }

            async login(credentials) {
                return this.request('/auth/login', {
                    method: 'POST',
                    body: JSON.stringify(credentials)
                });
            }

            // Student endpoints
            async getStudentProfile() {
                return this.request('/students/profile');
            }

            async updateStudentProfile(profileData) {
                return this.request('/students/profile', {
                    method: 'PUT',
                    body: JSON.stringify(profileData)
                });
            }

            async getStudentResults() {
                return this.request('/students/results');
            }

            // Archive endpoints
            async archiveAnnouncement(announcementId) {
                return this.request(`/students/archives/${announcementId}`, {
                    method: 'POST'
                });
            }

            async getArchivedItems() {
                return this.request('/students/archives');
            }

            async removeFromArchive(archiveId) {
                return this.request(`/students/archives/${archiveId}`, {
                    method: 'DELETE'
                });
            }

            // Announcements endpoints
            async getAnnouncements(params = {}) {
                const queryString = new URLSearchParams(params).toString();
                const endpoint = queryString ? `/announcements?${queryString}` : '/announcements';
                return this.request(endpoint);
            }

            async getFeaturedAnnouncements() {
                return this.request('/announcements/featured');
            }

            async getAnnouncement(id) {
                return this.request(`/announcements/${id}`);
            }

            // Timetable endpoints
            async getTimetable(level) {
                return this.request('/students/timetable');
            }

            // Health check
            async healthCheck() {
                return this.request('/health');
            }
        }

        // AuthManager Class
        class AuthManager {
            constructor() {
                this.currentUser = null;
                this.isAuthenticated = false;
                this.init();
            }

            init() {
                const token = localStorage.getItem('authToken');
                const userData = localStorage.getItem('userData');
                
                if (token && userData) {
                    try {
                        this.currentUser = JSON.parse(userData);
                        this.isAuthenticated = true;
                        api.setToken(token);
                        console.log('User restored from localStorage');
                    } catch (error) {
                        console.error('Error restoring user:', error);
                        this.logout();
                    }
                }
            }

            async login(credentials) {
                try {
                    console.log('Attempting login with:', { 
                        ...credentials, 
                        password: credentials.password ? '***' : 'missing' 
                    });
                    
                    const response = await api.login(credentials);
                    
                    this.currentUser = response.user;
                    this.isAuthenticated = true;
                    
                    api.setToken(response.token);
                    localStorage.setItem('userData', JSON.stringify(response.user));
                    
                    console.log('Login successful:', this.currentUser);
                    Helpers.showToast('Login successful!', 'success');
                    return { success: true, user: response.user };
                } catch (error) {
                    console.error('Login failed:', error);
                    const errorMessage = error.message || 'Login failed. Please check your credentials.';
                    Helpers.showToast(errorMessage, 'error');
                    return { success: false, error: errorMessage };
                }
            }

            async signup(userData) {
                try {
                    console.log('Attempting signup');
                    const response = await api.signup(userData);
                    
                    this.currentUser = response.user;
                    this.isAuthenticated = true;
                    
                    api.setToken(response.token);
                    localStorage.setItem('userData', JSON.stringify(response.user));
                    
                    Helpers.showToast('Registration successful!', 'success');
                    return { success: true, user: response.user };
                } catch (error) {
                    const errorMessage = error.message || 'Registration failed';
                    Helpers.showToast(errorMessage, 'error');
                    return { success: false, error: errorMessage };
                }
            }

            logout() {
                this.currentUser = null;
                this.isAuthenticated = false;
                
                api.removeToken();
                localStorage.removeItem('userData');
                
                Helpers.showToast('Logged out successfully', 'success');
                window.location.hash = 'login';
            }

            getCurrentUser() {
                return this.currentUser;
            }

            updateUserProfile(updatedUser) {
                this.currentUser = { ...this.currentUser, ...updatedUser };
                localStorage.setItem('userData', JSON.stringify(this.currentUser));
            }
        }

        // Main Application Class
        class StudentPortalApp {
            constructor() {
                this.currentPage = 'dashboard';
                this.pages = {
                    'login': this.renderLoginPage.bind(this),
                    'signup': this.renderSignupPage.bind(this),
                    'dashboard': this.renderDashboard.bind(this),
                    'announcements': this.renderAnnouncementsPage.bind(this),
                    'timetable': this.renderTimetablePage.bind(this),
                    'courses': this.renderCoursesPage.bind(this),
                    'profile': this.renderProfilePage.bind(this),
                    'archive': this.renderArchivePage.bind(this)
                };
                
                this.init();
            }

            init() {
                this.setupEventListeners();
                this.handleRoute();
            }

            setupEventListeners() {
                // Navigation toggle for mobile
                const navToggle = document.getElementById('nav-toggle');
                if (navToggle) {
                    navToggle.addEventListener('click', this.toggleMobileMenu.bind(this));
                }
                
                // Close mobile menu when clicking outside
                document.addEventListener('click', (e) => {
                    if (!e.target.closest('.nav__menu') && !e.target.closest('.nav__toggle')) {
                        this.closeMobileMenu();
                    }
                });
            }

            toggleMobileMenu() {
                const navMenu = document.getElementById('nav-menu');
                const navToggle = document.getElementById('nav-toggle');
                
                if (navMenu) navMenu.classList.toggle('active');
                if (navToggle) navToggle.classList.toggle('active');
            }

            closeMobileMenu() {
                const navMenu = document.getElementById('nav-menu');
                const navToggle = document.getElementById('nav-toggle');
                
                if (navMenu) navMenu.classList.remove('active');
                if (navToggle) navToggle.classList.remove('active');
            }

            handleRoute() {
                const hash = window.location.hash.replace('#', '') || 'dashboard';
                
                if (this.pages[hash]) {
                    this.currentPage = hash;
                    this.renderPage();
                } else {
                    this.navigateTo('dashboard');
                }
            }

            navigateTo(page) {
                if (this.pages[page]) {
                    window.location.hash = page;
                    this.currentPage = page;
                    this.renderPage();
                }
            }

            async renderPage() {
                const mainContent = document.getElementById('main-content');
                if (!mainContent) return;

                // Check authentication for protected routes
                const protectedRoutes = ['dashboard', 'announcements', 'timetable', 'courses', 'profile', 'archive'];
                
                if (protectedRoutes.includes(this.currentPage) && !authManager.isAuthenticated) {
                    this.navigateTo('login');
                    return;
                }
                
                // Redirect to dashboard if already authenticated and trying to access auth pages
                if (['login', 'signup'].includes(this.currentPage) && authManager.isAuthenticated) {
                    this.navigateTo('dashboard');
                    return;
                }

                Helpers.showLoading();
                
                try {
                    await this.pages[this.currentPage]();
                    this.updateNavigation();
                } catch (error) {
                    console.error('Error rendering page:', error);
                    Helpers.showToast('Error loading page', 'error');
                } finally {
                    Helpers.hideLoading();
                }
            }

            updateNavigation() {
                const navList = document.getElementById('nav-list');
                const navUser = document.getElementById('nav-user');
                
                if (!navList || !navUser) return;

                if (!authManager.isAuthenticated) {
                    navList.innerHTML = '';
                    navUser.innerHTML = `
                        <a href="#login" class="btn btn--outline btn--sm">Login</a>
                        <a href="#signup" class="btn btn--primary btn--sm">Sign Up</a>
                    `;
                    return;
                }

                // Navigation items for authenticated users
                const user = authManager.getCurrentUser();
                navList.innerHTML = `
                    <li><a href="#dashboard" class="nav__link ${this.currentPage === 'dashboard' ? 'active' : ''}">Dashboard</a></li>
                    <li><a href="#announcements" class="nav__link ${this.currentPage === 'announcements' ? 'active' : ''}">Announcements</a></li>
                    <li><a href="#timetable" class="nav__link ${this.currentPage === 'timetable' ? 'active' : ''}">Timetable</a></li>
                    <li><a href="#courses" class="nav__link ${this.currentPage === 'courses' ? 'active' : ''}">Courses</a></li>
                    <li><a href="#profile" class="nav__link ${this.currentPage === 'profile' ? 'active' : ''}">Profile & Results</a></li>
                    <li><a href="#archive" class="nav__link ${this.currentPage === 'archive' ? 'active' : ''}">Archive</a></li>
                `;

                // User menu
                navUser.innerHTML = `
                    <div class="user-menu">
                        <div class="user-avatar" id="user-avatar">
                            ${Helpers.getInitials(user.name)}
                        </div>
                        <div class="user-dropdown" id="user-dropdown">
                            <div class="user-dropdown__item">
                                <strong>${user.name}</strong>
                            </div>
                            <div class="user-dropdown__item">
                                ${user.matricNumber}
                            </div>
                            <div class="user-dropdown__item">
                                ${Helpers.getLevelLabel(user.level)}
                            </div>
                            <div class="user-dropdown__item" onclick="authManager.logout()">
                                Logout
                            </div>
                        </div>
                    </div>
                `;

                // User dropdown toggle
                const userAvatar = document.getElementById('user-avatar');
                const userDropdown = document.getElementById('user-dropdown');
                
                if (userAvatar && userDropdown) {
                    userAvatar.addEventListener('click', (e) => {
                        e.stopPropagation();
                        userDropdown.classList.toggle('show');
                    });

                    // Close dropdown when clicking outside
                    document.addEventListener('click', () => {
                        userDropdown.classList.remove('show');
                    });
                }
            }

            // Page rendering methods
            async renderLoginPage() {
                const mainContent = document.getElementById('main-content');
                if (!mainContent) return;
                
                mainContent.innerHTML = `
                    <div class="container">
                        <div class="grid" style="grid-template-columns: 1fr; max-width: 400px; margin: 0 auto;">
                            <div class="card">
                                <div class="card__header text-center">
                                    <h1 class="card__title">Welcome Back</h1>
                                    <p class="card__subtitle">Sign in to your account</p>
                                </div>
                                <div class="card__body">
                                    <form id="login-form">
                                        <div class="form-group">
                                            <label class="form-label" for="identifier">Email or Matric Number</label>
                                            <input type="text" class="form-control" id="identifier" name="identifier" required>
                                            <div class="form-error" id="identifier-error"></div>
                                        </div>
                                        
                                        <div class="form-group">
                                            <label class="form-label" for="password">Password</label>
                                            <input type="password" class="form-control" id="password" name="password" required>
                                            <div class="form-error" id="password-error"></div>
                                        </div>
                                        
                                        <div class="form-group d-flex justify-between align-center">
                                            <label class="form-label mb-0">
                                                <input type="checkbox" id="remember" name="remember">
                                                Remember me
                                            </label>
                                        </div>
                                        
                                        <button type="submit" class="btn btn--primary w-100 mb-2">Sign In</button>
                                        
                                        <div class="text-center">
                                            <p>Don't have an account? <a href="#signup" style="color: var(--primary); text-decoration: none;">Sign up</a></p>
                                        </div>
                                    </form>
                                </div>
                            </div>
                        </div>
                    </div>
                `;

                const loginForm = document.getElementById('login-form');
                if (loginForm) {
                    loginForm.addEventListener('submit', (e) => this.handleLogin(e));
                }
            }

            async handleLogin(e) {
                e.preventDefault();
                
                const identifier = document.getElementById('identifier').value;
                const password = document.getElementById('password').value;

                console.log('Login attempt with:', { identifier, password: '***' });

                const formData = {
                    identifier: identifier,
                    password: password
                };

                const validation = Validators.validateLoginForm(formData);
                
                if (!validation.isValid) {
                    this.displayFormErrors(validation.errors);
                    return;
                }

                this.clearFormErrors();

                // Show loading state on button
                const submitBtn = e.target.querySelector('button[type="submit"]');
                const originalText = submitBtn.textContent;
                submitBtn.textContent = 'Signing In...';
                submitBtn.disabled = true;

                try {
                    // Determine if identifier is email or matric number and format accordingly
                    let loginData;
                    if (Helpers.validateEmail(identifier)) {
                        loginData = { email: identifier, password: password };
                    } else {
                        loginData = { matricNumber: identifier, password: password };
                    }

                    console.log('Sending login data to backend:', { ...loginData, password: '***' });
                    
                    const result = await authManager.login(loginData);
                    
                    if (result.success) {
                        console.log('Login successful, navigating to dashboard');
                        this.navigateTo('dashboard');
                    } else {
                        console.log('Login failed:', result.error);
                    }
                } catch (error) {
                    console.error('Unexpected error during login:', error);
                    Helpers.showToast('An unexpected error occurred', 'error');
                } finally {
                    // Restore button state
                    submitBtn.textContent = originalText;
                    submitBtn.disabled = false;
                }
            }

            async renderSignupPage() {
                const mainContent = document.getElementById('main-content');
                if (!mainContent) return;
                
                mainContent.innerHTML = `
                    <div class="container">
                        <div class="grid" style="grid-template-columns: 1fr; max-width: 500px; margin: 0 auto;">
                            <div class="card">
                                <div class="card__header text-center">
                                    <h1 class="card__title">Create Account</h1>
                                    <p class="card__subtitle">Join the Computer Science Department</p>
                                </div>
                                <div class="card__body">
                                    <form id="signup-form">
                                        <div class="form-group">
                                            <label class="form-label" for="name">Full Name</label>
                                            <input type="text" class="form-control" id="name" name="name" required>
                                            <div class="form-error" id="name-error"></div>
                                        </div>
                                        
                                        <div class="form-group">
                                            <label class="form-label" for="email">Email Address</label>
                                            <input type="email" class="form-control" id="email" name="email" required>
                                            <div class="form-error" id="email-error"></div>
                                        </div>
                                        
                                        <div class="form-group">
                                            <label class="form-label" for="matricNumber">Matric Number</label>
                                            <input type="text" class="form-control" id="matricNumber" name="matricNumber" required>
                                            <div class="form-error" id="matricNumber-error"></div>
                                        </div>
                                        
                                        <div class="grid grid--2">
                                            <div class="form-group">
                                                <label class="form-label" for="level">Level</label>
                                                <select class="form-control" id="level" name="level" required>
                                                    <option value="">Select Level</option>
                                                    <option value="100">100 Level</option>
                                                    <option value="200">200 Level</option>
                                                    <option value="300">300 Level</option>
                                                    <option value="400">400 Level</option>
                                                    <option value="500">500 Level</option>
                                                </select>
                                                <div class="form-error" id="level-error"></div>
                                            </div>
                                            
                                            <div class="form-group">
                                                <label class="form-label" for="studentType">Student Type</label>
                                                <select class="form-control" id="studentType" name="studentType" required>
                                                    <option value="">Select Type</option>
                                                    <option value="Undergraduate">Undergraduate</option>
                                                    <option value="Postgraduate">Postgraduate</option>
                                                </select>
                                                <div class="form-error" id="studentType-error"></div>
                                            </div>
                                        </div>
                                        
                                        <div class="form-group">
                                            <label class="form-label" for="phone">Phone Number</label>
                                            <input type="tel" class="form-control" id="phone" name="phone" required>
                                            <div class="form-error" id="phone-error"></div>
                                        </div>
                                        
                                        <div class="form-group">
                                            <label class="form-label" for="password">Password</label>
                                            <input type="password" class="form-control" id="password" name="password" required>
                                            <div class="form-error" id="password-error"></div>
                                        </div>
                                        
                                        <button type="submit" class="btn btn--primary w-100 mb-2">Create Account</button>
                                        
                                        <div class="text-center">
                                            <p>Already have an account? <a href="#login" style="color: var(--primary); text-decoration: none;">Sign in</a></p>
                                        </div>
                                    </form>
                                </div>
                            </div>
                        </div>
                    </div>
                `;

                const signupForm = document.getElementById('signup-form');
                if (signupForm) {
                    signupForm.addEventListener('submit', (e) => this.handleSignup(e));
                }
            }

            async handleSignup(e) {
                e.preventDefault();
                
                const formData = {
                    name: document.getElementById('name').value,
                    email: document.getElementById('email').value,
                    matricNumber: document.getElementById('matricNumber').value,
                    level: document.getElementById('level').value,
                    studentType: document.getElementById('studentType').value,
                    phone: document.getElementById('phone').value,
                    password: document.getElementById('password').value
                };

                const validation = Validators.validateSignupForm(formData);
                
                if (!validation.isValid) {
                    this.displayFormErrors(validation.errors);
                    return;
                }

                this.clearFormErrors();

                const result = await authManager.signup(formData);
                
                if (result.success) {
                    this.navigateTo('dashboard');
                }
            }

            async renderDashboard() {
                const mainContent = document.getElementById('main-content');
                if (!mainContent) return;
                
                const user = authManager.getCurrentUser();
                
                // Debug information
                console.log('Dashboard - User:', user);
                console.log('Dashboard - Is Authenticated:', authManager.isAuthenticated);
                
                // If user is not authenticated, show login prompt
                if (!user || !authManager.isAuthenticated) {
                    mainContent.innerHTML = `
                        <div class="container">
                            <div class="card text-center">
                                <div class="card__body">
                                    <h2>Authentication Required</h2>
                                    <p>Please log in to access the dashboard.</p>
                                    <a href="#login" class="btn btn--primary">Go to Login</a>
                                </div>
                            </div>
                        </div>
                    `;
                    return;
                }

                // Get current academic year
                const currentYear = new Date().getFullYear();
                const academicYear = `${currentYear}`;

                mainContent.innerHTML = `
                    <div class="container">
                        <div class="mb-4">
                            <h1>Welcome to ${academicYear} Academic Session!</h1>
                            <p class="text-light">Hello ${user.name}! Ready for a successful ${academicYear} academic year in Computer Science?</p>
                        </div>
                        
                        <!-- Quick Stats -->
                        <div class="grid grid--3 mb-4">
                            <div class="card text-center">
                                <div class="card__body">
                                    <div class="quick-action__icon">üì¢</div>
                                    <h3>12</h3>
                                    <p class="text-light">2026 Announcements</p>
                                </div>
                            </div>
                            <div class="card text-center">
                                <div class="card__body">
                                    <div class="quick-action__icon">üìä</div>
                                    <h3>8</h3>
                                    <p class="text-light">Available Courses</p>
                                </div>
                            </div>
                            <div class="card text-center">
                                <div class="card__body">
                                    <div class="quick-action__icon">‚è∞</div>
                                    <h3>5</h3>
                                    <p class="text-light">Upcoming Deadlines</p>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Quick Actions -->
                        <div class="grid grid--4 mb-4">
                            <div class="card quick-action" onclick="app.navigateTo('announcements')">
                                <div class="quick-action__icon">üì¢</div>
                                <h3 class="quick-action__title">Announcements</h3>
                                <p class="quick-action__description">View all department announcements</p>
                            </div>
                            
                            <div class="card quick-action" onclick="app.navigateTo('timetable')">
                                <div class="quick-action__icon">üìÖ</div>
                                <h3 class="quick-action__title">Timetable</h3>
                                <p class="quick-action__description">Check your class schedule</p>
                            </div>
                            
                            <div class="card quick-action" onclick="app.navigateTo('courses')">
                                <div class="quick-action__icon">üìö</div>
                                <h3 class="quick-action__title">Courses</h3>
                                <p class="quick-action__description">Browse available courses</p>
                            </div>
                            
                            <div class="card quick-action" onclick="app.navigateTo('profile')">
                                <div class="quick-action__icon">üìä</div>
                                <h3 class="quick-action__title">Results</h3>
                                <p class="quick-action__description">View your academic results</p>
                            </div>
                        </div>
                        
                        <div class="grid grid--2">
                            <!-- Featured Announcements -->
                            <div class="card">
                                <div class="card__header">
                                    <h2 class="card__title">Featured Announcements</h2>
                                    <p class="card__subtitle">Important updates from the department</p>
                                </div>
                                <div class="card__body">
                                    ${this.generateSampleAnnouncements()}
                                </div>
                            </div>
                            
                            <!-- Department News -->
                            <div class="card department-news">
                                <div class="card__header">
                                    <h2 class="card__title">Department News - 2026</h2>
                                    <p class="card__subtitle">Latest updates from Computer Science Department</p>
                                </div>
                                <div class="card__body">
                                    <div class="mb-3">
                                        <h4>üéØ 2026 Academic Focus</h4>
                                        <p>This year, we're focusing on AI, Cybersecurity, and Cloud Computing. New courses have been added to the curriculum.</p>
                                    </div>
                                    <div class="mb-3">
                                        <h4>üèÜ 2026 Tech Competitions</h4>
                                        <p>Several national and international tech competitions are scheduled for 2026. Stay tuned for registration details.</p>
                                    </div>
                                    <div class="mb-3">
                                        <h4>üî¨ Research Opportunities 2026</h4>
                                        <p>Research grants and internship opportunities for 2026 are now available. Check the announcements regularly.</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            }

            // Generate sample announcements for dashboard
            generateSampleAnnouncements() {
                const sampleAnnouncements = [
                    {
                        id: '1',
                        title: 'Mid-Semester Examination Schedule - 2026',
                        content: 'The mid-semester examinations for 2026 will commence from March 15th, 2026. All students are advised to check their timetable and prepare accordingly.',
                        category: 'exam',
                        isFeatured: true,
                        createdAt: new Date().toISOString(),
                        author: { name: 'Exam Department' }
                    },
                    {
                        id: '2', 
                        title: 'Course Registration Deadline Extended - 2026',
                        content: 'The deadline for 2026 course registration has been extended to February 28th, 2026. Please complete your registration before the new deadline.',
                        category: 'registration',
                        isUrgent: true,
                        createdAt: new Date().toISOString(),
                        author: { name: 'Academic Office' }
                    },
                    {
                        id: '3',
                        title: 'New Course Offerings - 2026',
                        content: 'Several new courses including Advanced AI and Cloud Computing have been added to the 2026 curriculum. Check the courses page for details.',
                        category: 'general',
                        isFeatured: true,
                        createdAt: new Date().toISOString(),
                        author: { name: 'Curriculum Committee' }
                    }
                ];
                
                return this.renderAnnouncementsList(sampleAnnouncements);
            }

            // Render announcements list
            renderAnnouncementsList(announcements) {
                if (!announcements || announcements.length === 0) {
                    return '<p class="text-center text-light">No announcements available.</p>';
                }
                
                return announcements.map(announcement => `
                    <div class="card announcement-card ${announcement.isFeatured ? 'featured' : ''} ${announcement.isUrgent ? 'urgent' : ''}">
                        <div class="card__body">
                            <span class="announcement-card__category">
                                ${Helpers.getCategoryLabel(announcement.category)}
                            </span>
                            <h3 class="announcement-card__title">${Helpers.sanitizeInput(announcement.title)}</h3>
                            <div class="announcement-card__content">
                                ${Helpers.sanitizeInput(announcement.content)}
                            </div>
                            <div class="announcement-card__meta">
                                <span>By ${announcement.author?.name || 'Department'}</span>
                                <span>${Helpers.formatDate(announcement.createdAt)}</span>
                            </div>
                            <div class="announcement-card__actions">
                                <button class="btn btn--secondary btn--sm" onclick="app.archiveAnnouncement('${announcement.id}')">
                                    üìÅ Archive
                                </button>
                            </div>
                        </div>
                    </div>
                `).join('');
            }

            // Archive announcement method
            async archiveAnnouncement(announcementId) {
                try {
                    await api.archiveAnnouncement(announcementId);
                    Helpers.showToast('Announcement archived successfully', 'success');
                } catch (error) {
                    Helpers.showToast('Error archiving announcement', 'error');
                }
            }

            // Courses page render method
            async renderCoursesPage() {
                const mainContent = document.getElementById('main-content');
                if (!mainContent) return;
                
                mainContent.innerHTML = `
                    <div class="container">
                        <div class="mb-4">
                            <h1>Available Courses - 2026</h1>
                            <p class="text-light">Browse all courses offered by the Computer Science Department</p>
                        </div>
                        
                        <div class="grid grid--2">
                            ${this.generateCourseCards()}
                        </div>
                    </div>
                `;
            }

            // Generate course cards for courses page
            generateCourseCards() {
                const courses = [
                    {
                        code: 'CIT 401',
                        title: 'Database Management Systems Design',
                        description: 'Advanced database design principles, normalization, SQL optimization, and database administration. Covers distributed databases and NoSQL systems.',
                        credits: 3,
                        level: '400',
                        semester: 'Both'
                    },
                    {
                        code: 'CSC 405', 
                        title: 'Algorithms and Complexity Analysis',
                        description: 'Analysis of algorithm efficiency, complexity theory, NP-completeness, advanced data structures, and algorithm design techniques.',
                        credits: 3,
                        level: '400',
                        semester: 'First'
                    },
                    {
                        code: 'CSC 407',
                        title: 'Computer and Society',
                        description: 'Ethical, social, and professional issues in computing. Impact of technology on society, privacy, security, and professional responsibility.',
                        credits: 2,
                        level: '400',
                        semester: 'Second'
                    },
                    {
                        code: 'IFT 405',
                        title: 'Research Methodology and Capstone',
                        description: 'Research methods, project planning, and execution. Students complete a capstone project demonstrating comprehensive knowledge.',
                        credits: 4,
                        level: '400',
                        semester: 'Both'
                    },
                    {
                        code: 'CSC 401',
                        title: 'Software Engineering',
                        description: 'Software development lifecycle, requirements analysis, design patterns, testing methodologies, and project management.',
                        credits: 3,
                        level: '400',
                        semester: 'First'
                    },
                    {
                        code: 'CSC 403',
                        title: 'Artificial Intelligence',
                        description: 'Machine learning, neural networks, natural language processing, and intelligent systems design and implementation.',
                        credits: 3,
                        level: '400',
                        semester: 'Second'
                    }
                ];

                return courses.map(course => `
                    <div class="card course-card">
                        <div class="card__body">
                            <div class="d-flex justify-between align-center mb-2">
                                <span class="course-code">${course.code}</span>
                                <span class="course-credits">${course.credits} Credits</span>
                            </div>
                            <h3 class="announcement-card__title">${course.title}</h3>
                            <div class="announcement-card__content">
                                ${course.description}
                            </div>
                            <div class="announcement-card__meta">
                                <span>Level: ${course.level}</span>
                                <span>Semester: ${course.semester}</span>
                            </div>
                        </div>
                    </div>
                `).join('');
            }

            // ANNOUNCEMENTS PAGE
            async renderAnnouncementsPage() {
                const mainContent = document.getElementById('main-content');
                if (!mainContent) return;
                
                // Fetch all announcements
                let announcements = [];
                try {
                    const response = await api.getAnnouncements();
                    announcements = response.announcements || response || [];
                } catch (error) {
                    console.error('Error fetching announcements:', error);
                }

                mainContent.innerHTML = `
                    <div class="container">
                        <div class="d-flex justify-between align-center mb-4">
                            <div>
                                <h1>Announcements</h1>
                                <p class="text-light">Stay updated with department news</p>
                            </div>
                            <div class="search-box">
                                <input type="text" class="form-control search-box__input" id="search-announcements" placeholder="Search announcements...">
                                <span class="search-box__icon">üîç</span>
                            </div>
                        </div>
                        
                        <!-- Filters -->
                        <div class="card mb-4">
                            <div class="card__body">
                                <div class="filter-group">
                                    <select class="filter-select" id="category-filter">
                                        <option value="">All Categories</option>
                                        <option value="general">General</option>
                                        <option value="exam">Exam</option>
                                        <option value="registration">Registration</option>
                                        <option value="security">Security</option>
                                        <option value="event">Event</option>
                                    </select>
                                    
                                    <select class="filter-select" id="featured-filter">
                                        <option value="">All Announcements</option>
                                        <option value="featured">Featured Only</option>
                                        <option value="urgent">Urgent Only</option>
                                    </select>
                                    
                                    <button class="btn btn--outline" id="clear-filters">Clear Filters</button>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Announcements Grid -->
                        <div class="grid grid--2" id="announcements-grid">
                            ${this.renderAnnouncementsList(announcements)}
                        </div>
                        
                        ${announcements.length === 0 ? 
                            '<div class="text-center mt-4"><p>No announcements found.</p></div>' : 
                            ''
                        }
                    </div>
                `;

                this.setupAnnouncementsFilters();
            }

            setupAnnouncementsFilters() {
                const searchInput = document.getElementById('search-announcements');
                const categoryFilter = document.getElementById('category-filter');
                const featuredFilter = document.getElementById('featured-filter');
                const clearFiltersBtn = document.getElementById('clear-filters');

                const debouncedSearch = Helpers.debounce(async (searchTerm) => {
                    await this.filterAnnouncements();
                }, 300);

                searchInput.addEventListener('input', (e) => {
                    debouncedSearch(e.target.value);
                });

                categoryFilter.addEventListener('change', this.filterAnnouncements.bind(this));
                featuredFilter.addEventListener('change', this.filterAnnouncements.bind(this));
                
                clearFiltersBtn.addEventListener('click', () => {
                    searchInput.value = '';
                    categoryFilter.value = '';
                    featuredFilter.value = '';
                    this.filterAnnouncements();
                });
            }

            async filterAnnouncements() {
                const searchTerm = document.getElementById('search-announcements').value;
                const category = document.getElementById('category-filter').value;
                const featured = document.getElementById('featured-filter').value;

                const params = {};
                if (searchTerm) params.search = searchTerm;
                if (category) params.category = category;
                if (featured === 'featured') params.featured = true;
                if (featured === 'urgent') params.urgent = true;

                try {
                    Helpers.showLoading();
                    const response = await api.getAnnouncements(params);
                    const announcementsGrid = document.getElementById('announcements-grid');
                    announcementsGrid.innerHTML = this.renderAnnouncementsList(response.announcements || response || []);
                } catch (error) {
                    Helpers.showToast('Error filtering announcements', 'error');
                } finally {
                    Helpers.hideLoading();
                }
            }

            // TIMETABLE PAGE
            async renderTimetablePage() {
                const mainContent = document.getElementById('main-content');
                if (!mainContent) return;
                const user = authManager.getCurrentUser();
                
                mainContent.innerHTML = `
                    <div class="container">
                        <div class="mb-4">
                            <h1>Class Timetable</h1>
                            <p class="text-light">View and download your class schedules</p>
                        </div>
                        
                        <div class="card">
                            <div class="card__body">
                                <div class="filter-group mb-4">
                                    <select class="filter-select" id="level-select">
                                        <option value="100">100 Level</option>
                                        <option value="200">200 Level</option>
                                        <option value="300">300 Level</option>
                                        <option value="400">400 Level</option>
                                        <option value="500">500 Level</option>
                                    </select>
                                    
                                    <select class="filter-select" id="semester-select">
                                        <option value="first">First Semester</option>
                                        <option value="second">Second Semester</option>
                                    </select>
                                    
                                    <button class="btn btn--primary" id="load-timetable">Load Timetable</button>
                                </div>
                                
                                <div id="timetable-content">
                                    <p class="text-center text-light">Select your level and semester to view timetable</p>
                                </div>
                            </div>
                        </div>
                    </div>
                `;

                // Set current user's level as default
                document.getElementById('level-select').value = user.level || 200;
                
                document.getElementById('load-timetable').addEventListener('click', this.loadTimetable.bind(this));
            }

            async loadTimetable() {
                const level = document.getElementById('level-select').value;
                const semester = document.getElementById('semester-select').value;
                
                try {
                    Helpers.showLoading();
                    const timetable = await api.getTimetable(level);
                    const timetableContent = document.getElementById('timetable-content');
                    
                    if (timetable && timetable.fileUrl) {
                        timetableContent.innerHTML = `
                            <div class="text-center">
                                <h3>${timetable.title || `Timetable for ${Helpers.getLevelLabel(level)} - ${semester === 'first' ? 'First' : 'Second'} Semester`}</h3>
                                <p class="mb-3">Click the button below to view/download the timetable</p>
                                <a href="${timetable.fileUrl}" class="btn btn--primary" target="_blank">
                                    üì• Download Timetable
                                </a>
                                <div class="mt-4">
                                    <p><strong>Last Updated:</strong> ${timetable.updatedAt ? Helpers.formatDate(timetable.updatedAt) : 'N/A'}</p>
                                </div>
                            </div>
                        `;
                    } else {
                        timetableContent.innerHTML = `
                            <p class="text-center text-light">No timetable available for ${Helpers.getLevelLabel(level)} ${semester} semester.</p>
                        `;
                    }
                } catch (error) {
                    console.error('Timetable error:', error);
                    Helpers.showToast('Timetable not available for your level', 'warning');
                    document.getElementById('timetable-content').innerHTML = `
                        <p class="text-center text-light">Timetable not available. Please contact administration.</p>
                    `;
                } finally {
                    Helpers.hideLoading();
                }
            }

            // PROFILE & RESULTS PAGE
            async renderProfilePage() {
                const mainContent = document.getElementById('main-content');
                if (!mainContent) return;
                
                const user = authManager.getCurrentUser();
                
                // Fetch student results
                let results = [];
                try {
                    const response = await api.getStudentResults();
                    results = response.results || response || [];
                } catch (error) {
                    console.error('Error fetching results:', error);
                }

                mainContent.innerHTML = `
                    <div class="container">
                        <div class="grid grid--2">
                            <!-- Profile Section -->
                            <div>
                                <div class="card mb-4">
                                    <div class="card__header">
                                        <h2 class="card__title">Profile Information</h2>
                                    </div>
                                    <div class="card__body">
                                        <div class="profile-header">
                                            <div class="profile-avatar">
                                                ${Helpers.getInitials(user.name)}
                                            </div>
                                            <div class="profile-info">
                                                <h2>${user.name}</h2>
                                                <p>${user.matricNumber} ‚Ä¢ ${Helpers.getLevelLabel(user.level)}</p>
                                                <p>${user.studentType} ‚Ä¢ ${user.department}</p>
                                            </div>
                                        </div>
                                        
                                        <form id="profile-form">
                                            <div class="form-group">
                                                <label class="form-label" for="profile-name">Full Name</label>
                                                <input type="text" class="form-control" id="profile-name" name="name" value="${user.name}" required>
                                                <div class="form-error" id="profile-name-error"></div>
                                            </div>
                                            
                                            <div class="form-group">
                                                <label class="form-label" for="profile-email">Email Address</label>
                                                <input type="email" class="form-control" id="profile-email" name="email" value="${user.email}" required>
                                                <div class="form-error" id="profile-email-error"></div>
                                            </div>
                                            
                                            <div class="form-group">
                                                <label class="form-label" for="profile-phone">Phone Number</label>
                                                <input type="tel" class="form-control" id="profile-phone" name="phone" value="${user.phone || ''}" required>
                                                <div class="form-error" id="profile-phone-error"></div>
                                            </div>
                                            
                                            <button type="submit" class="btn btn--primary">Update Profile</button>
                                        </form>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Results Section -->
                            <div>
                                <div class="card">
                                    <div class="card__header">
                                        <h2 class="card__title">Academic Results</h2>
                                        <p class="card__subtitle">Your course grades and performance</p>
                                    </div>
                                    <div class="card__body">
                                        ${results.length > 0 ? this.renderResultsTable(results) : `
                                            <p class="text-center text-light">No results available at the moment.</p>
                                        `}
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                `;

                document.getElementById('profile-form').addEventListener('submit', this.handleProfileUpdate.bind(this));
            }

            renderResultsTable(results) {
                return `
                    <div class="table-responsive">
                        <table class="results-table">
                            <thead>
                                <tr>
                                    <th>Course Code</th>
                                    <th>Course Title</th>
                                    <th>Grade</th>
                                    <th>Semester</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${results.map(result => `
                                    <tr>
                                        <td>${result.courseCode}</td>
                                        <td>${result.courseTitle}</td>
                                        <td><strong>${result.grade}</strong></td>
                                        <td>${result.semester}</td>
                                    </tr>
                                `).join('')}
                            </tbody>
                        </table>
                    </div>
                `;
            }

            async handleProfileUpdate(e) {
                e.preventDefault();
                
                const formData = {
                    name: document.getElementById('profile-name').value,
                    email: document.getElementById('profile-email').value,
                    phone: document.getElementById('profile-phone').value
                };

                const validation = Validators.validateProfileForm(formData);
                
                if (!validation.isValid) {
                    this.displayFormErrors(validation.errors, 'profile-');
                    return;
                }

                this.clearFormErrors('profile-');

                try {
                    const response = await api.updateStudentProfile(formData);
                    authManager.updateUserProfile(response.user);
                    Helpers.showToast('Profile updated successfully', 'success');
                } catch (error) {
                    Helpers.showToast('Error updating profile', 'error');
                }
            }

            // ARCHIVE PAGE
            async renderArchivePage() {
                const mainContent = document.getElementById('main-content');
                if (!mainContent) return;
                
                // Fetch archived items
                let archivedItems = [];
                try {
                    const response = await api.getArchivedItems();
                    archivedItems = response.archives || response || [];
                } catch (error) {
                    console.error('Error fetching archived items:', error);
                }

                mainContent.innerHTML = `
                    <div class="container">
                        <div class="mb-4">
                            <h1>Archived Announcements</h1>
                            <p class="text-light">Your saved announcements for quick reference</p>
                        </div>
                        
                        ${archivedItems.length > 0 ? `
                            <div class="grid grid--2" id="archive-grid">
                                ${this.renderArchivedItemsList(archivedItems)}
                            </div>
                        ` : `
                            <div class="card">
                                <div class="card__body text-center">
                                    <h3>No Archived Items</h3>
                                    <p class="text-light">You haven't archived any announcements yet.</p>
                                    <a href="#announcements" class="btn btn--primary">Browse Announcements</a>
                                </div>
                            </div>
                        `}
                    </div>
                `;
            }

            renderArchivedItemsList(archivedItems) {
                return archivedItems.map(item => {
                    const announcement = item.announcement || item;
                    return `
                        <div class="card announcement-card">
                            <div class="card__body">
                                <span class="announcement-card__category">
                                    ${Helpers.getCategoryLabel(announcement.category)}
                                </span>
                                <h3 class="announcement-card__title">${Helpers.sanitizeInput(announcement.title)}</h3>
                                <div class="announcement-card__content">
                                    ${Helpers.sanitizeInput(announcement.content)}
                                </div>
                                <div class="announcement-card__meta">
                                    <span>Archived on ${Helpers.formatDate(item.archivedAt || item.createdAt)}</span>
                                </div>
                                <div class="announcement-card__actions">
                                    <button class="btn btn--danger btn--sm" onclick="app.removeFromArchive('${item.id}')">
                                        üóëÔ∏è Remove
                                    </button>
                                    ${announcement.fileUrl ? `
                                        <a href="${announcement.fileUrl}" class="btn btn--outline btn--sm" target="_blank">
                                            üìé Attachment
                                        </a>
                                    ` : ''}
                                </div>
                            </div>
                        </div>
                    `;
                }).join('');
            }

            async removeFromArchive(archiveId) {
                try {
                    await api.removeFromArchive(archiveId);
                    Helpers.showToast('Removed from archive', 'success');
                    // Refresh the archive page
                    this.renderArchivePage();
                } catch (error) {
                    Helpers.showToast('Error removing from archive', 'error');
                }
            }

            // Form error handling methods
            displayFormErrors(errors, prefix = '') {
                Object.keys(errors).forEach(field => {
                    const errorElement = document.getElementById(`${prefix}${field}-error`);
                    if (errorElement) {
                        errorElement.textContent = errors[field];
                        errorElement.classList.add('show');
                        
                        const inputElement = document.getElementById(`${prefix}${field}`);
                        if (inputElement) {
                            inputElement.classList.add('error');
                        }
                    }
                });
            }

            clearFormErrors(prefix = '') {
                const errorElements = document.querySelectorAll('.form-error');
                errorElements.forEach(element => {
                    element.classList.remove('show');
                    element.textContent = '';
                });

                const inputElements = document.querySelectorAll('.form-control');
                inputElements.forEach(element => {
                    element.classList.remove('error');
                });
            }
        }

        // Create global instances
        const api = new API();
        const authManager = new AuthManager();
        const app = new StudentPortalApp();

        // Handle hash changes
        window.addEventListener('hashchange', () => {
            app.handleRoute();
        });

        // Make app globally available for onclick handlers
        window.app = app;
        window.authManager = authManager;

        console.log('Student Portal App initialized');
    </script>
</body>
</html>
